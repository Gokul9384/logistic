{"version":3,"sources":["../../../src/Service/Admin/ErrorLog.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { error_log } from '@Database/Table/Admin/error_log';\r\nimport { ErrorLogDeleteModel, ErrorLogLazyLoadModel } from '@Model/Admin/ErrorLog.model';\r\nimport { DataSource, LessThanOrEqual } from 'typeorm';\r\n\r\n@Injectable()\r\nexport class ErrorLogService {\r\n  constructor(\r\n    private _DataSource: DataSource\r\n  ) {\r\n\r\n  }\r\n\r\n  async LazyLoadList(ErrorLogLazyLoadData: ErrorLogLazyLoadModel) {\r\n    const queryBuilder = this._DataSource.manager.createQueryBuilder(error_log, 'el');\r\n    queryBuilder\r\n      .select(['el.*', 'SUM(1) OVER() AS total_count'])\r\n      .where('el.created_on BETWEEN :start_date AND :end_date', {\r\n        start_date: ErrorLogLazyLoadData.start_date,\r\n        end_date: ErrorLogLazyLoadData.end_date,\r\n      });\r\n    queryBuilder.andWhere('el.created_by_id = :user_id', {\r\n      user_id: ErrorLogLazyLoadData.user_id,\r\n    });\r\n    queryBuilder.orderBy('el.created_on', 'DESC');\r\n    queryBuilder\r\n      .limit(ErrorLogLazyLoadData.take)\r\n      .offset(ErrorLogLazyLoadData.skip);\r\n    return await queryBuilder.getRawMany();\r\n  }\r\n\r\n  async DeleteByAsOfDate(ErrorLogDeleteData: ErrorLogDeleteModel) {\r\n    if (ErrorLogDeleteData.password == \"Login@321!!\") {\r\n      await error_log.delete({ created_on: LessThanOrEqual(ErrorLogDeleteData.as_of_date) });\r\n    }\r\n    else {\r\n      throw new Error(\"Password incorrect\");\r\n    }\r\n  }\r\n\r\n}\r\n\r\n"],"names":["ErrorLogService","LazyLoadList","ErrorLogLazyLoadData","queryBuilder","_DataSource","manager","createQueryBuilder","error_log","select","where","start_date","end_date","andWhere","user_id","orderBy","limit","take","offset","skip","getRawMany","DeleteByAsOfDate","ErrorLogDeleteData","password","delete","created_on","LessThanOrEqual","as_of_date","Error"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBANc;2BACD;yBAEkB;;;;;;;;;;AAGrC,IAAA,AAAMA,kBAAN,MAAMA;IAOX,MAAMC,aAAaC,oBAA2C,EAAE;QAC9D,MAAMC,eAAe,IAAI,CAACC,WAAW,CAACC,OAAO,CAACC,kBAAkB,CAACC,oBAAS,EAAE;QAC5EJ,aACGK,MAAM,CAAC;YAAC;YAAQ;SAA+B,EAC/CC,KAAK,CAAC,mDAAmD;YACxDC,YAAYR,qBAAqBQ,UAAU;YAC3CC,UAAUT,qBAAqBS,QAAQ;QACzC;QACFR,aAAaS,QAAQ,CAAC,+BAA+B;YACnDC,SAASX,qBAAqBW,OAAO;QACvC;QACAV,aAAaW,OAAO,CAAC,iBAAiB;QACtCX,aACGY,KAAK,CAACb,qBAAqBc,IAAI,EAC/BC,MAAM,CAACf,qBAAqBgB,IAAI;QACnC,OAAO,MAAMf,aAAagB,UAAU;IACtC;IAEA,MAAMC,iBAAiBC,kBAAuC,EAAE;QAC9D,IAAIA,mBAAmBC,QAAQ,IAAI,eAAe;YAChD,MAAMf,oBAAS,CAACgB,MAAM,CAAC;gBAAEC,YAAYC,IAAAA,wBAAe,EAACJ,mBAAmBK,UAAU;YAAE;QACtF,OACK;YACH,MAAM,IAAIC,MAAM;QAClB;IACF;IA/BA,YACE,AAAQvB,WAAuB,CAC/B;aADQA,cAAAA;IAGV;AA6BF"}